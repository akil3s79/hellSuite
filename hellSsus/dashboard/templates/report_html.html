{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <!-- Report Header -->
    <div class="page-header">
        <h1 class="page-title">HellSuite Security Report</h1>
        <p class="page-subtitle">Professional Security Assessment - {{ project.name }}</p>
        <div class="report-meta" style="margin-top: 20px; display: flex; gap: 2rem; justify-content: center;">
            <div><strong>Date:</strong> {{ current_date }}</div>
            <div><strong>Generated by:</strong> HellSuite v4.0</div>
        </div>
    </div>

    <!-- Stats Cards -->
<div class="stats">
    <div class="stat-card">
        <div class="stat-number" style="color: #910000; font-size: 3em ; font-weight: bold ; margin-bottom: 10px ;">{{ severity_counts.critical or 0 }}</div>
        <div class="stat-label">Critical</div>
    </div>
    <div class="stat-card">
        <div class="stat-number" style="color: #FF0000; font-size: 3em ; font-weight: bold ; margin-bottom: 10px ;">{{ severity_counts.high or 0 }}</div>
        <div class="stat-label">High</div>
    </div>
    <div class="stat-card">
        <div class="stat-number" style="color: #FFC000; font-size: 3em ; font-weight: bold ; margin-bottom: 10px ;">{{ severity_counts.medium or 0 }}</div>
        <div class="stat-label">Medium</div>
    </div>
    <div class="stat-card">
        <div class="stat-number" style="color: #00B050; font-size: 3em ; font-weight: bold ; margin-bottom: 10px ;">{{ severity_counts.low or 0 }}</div>
        <div class="stat-label">Low</div>
    </div>
    <div class="stat-card">
        <div class="stat-number" style="color: #3498db; font-size: 3em ; font-weight: bold ; margin-bottom: 10px ;">{{ severity_counts.info or 0 }}</div>
        <div class="stat-label">Info</div>
    </div>
</div>

    <!-- Executive Summary -->
    <div class="table-container" style="margin-bottom: 30px;">
        <div style="padding: 20px;">
            <h2 style="color: var(--dark-blue); margin-bottom: 15px;">Executive Summary</h2>
            <p>This report summarizes the security assessment findings for <strong>{{ project.name }}</strong>.</p>
            <p><strong>Total vulnerabilities found:</strong> {{ vulnerabilities|length }}</p>
            
            {% if critical_vulns %}
            <div style="margin-top: 15px; padding: 15px; background: #fed7d7; border-radius: 6px; border: 1px solid #A10202;">
                <strong>Critical Findings:</strong> {{ critical_vulns|length }} critical vulnerabilities require immediate attention.
            </div>
            {% endif %}
        </div>
    </div>

    <!-- Action Buttons -->
    <div style="display: flex; gap: 15px; margin-bottom: 30px; justify-content: center;">
        <a href="/project/{{ project.id }}/report/pdf" class="btn" style="background: #A10202;">
            Export to PDF
        </a>
        <a href="/project/{{ project.id }}/report/json" class="btn" style="background: var(--medium-blue);">
            Export for Pwndoc
        </a>
    </div>

    <!-- Detailed Vulnerabilities -->
    <div class="table-container">
        <div style="padding: 20px;">
            <h2 style="color: var(--dark-blue); margin-bottom: 20px;">Detailed Findings</h2>
            
            {% if vulnerabilities %}
                {% for vuln in vulnerabilities %}
                <div class="vulnerability-item" style="border: 1px solid var(--dark-blue); border-radius: 6px;">
                    <div class="vuln-header">
                        <span class="severity-badge severity-{{ vuln.severity }}">{{ vuln.severity.upper() }}</span>
                        <span class="vuln-type" style="text-transform: capitalize;">{{ vuln.type.replace('_', ' ') }}</span>
                        {% if vuln.cve %}
                        <span class="vuln-cve">{{ vuln.cve }}</span>
                        {% endif %}
                    </div>
                    
                    <div class="vuln-description">
                        {{ vuln.description }}
                    </div>
                    
                    {% if vuln.proof_of_concept %}
                    <div class="vuln-poc">
                        <strong>Proof of Concept:</strong>
                        <code>{{ vuln.proof_of_concept }}</code>
                    </div>
                    {% endif %}
                    
                    {% if vuln.recommendation %}
                    <div class="vuln-recommendation">
                        <strong>Recommendation:</strong> {{ vuln.recommendation }}
                    </div>
                    {% endif %}
                    
                    <div style="margin-top: 10px; font-size: 0.9em; color: var(--gray);">
                        <strong>Asset:</strong> {{ vuln.asset_url or 'N/A' }} | 
                        <strong>Discovered:</strong> {{ vuln.discovery_date[:16] if vuln.discovery_date else 'N/A' }}
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div style="text-align: center; padding: 40px; color: var(--gray);">
                    No vulnerabilities found for this project.
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}